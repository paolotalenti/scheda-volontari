<!DOCTYPE html>
<html lang="it">
<head>
    <title>Report Visite</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        body { padding: 20px; font-size: 1.2em; }
        .form-control, .btn { font-size: 1.2em; }
        .container { max-width: 1200px; }
        table { margin-top: 20px; }
    </style>
</head>
<body>
    <div class="container">
        <h1>Report Visite</h1>
        
        <!-- Form per i filtri -->
        <form method="post">
            <div class="row mb-3">
                <div class="col-md-4">
                    <label class="form-label">Filtra per Volontario</label>
                    <select name="volontario_email" class="form-control">
                        <option value="">Tutti i volontari</option>
                        {% for volontario in volontari %}
                            <option value="{{ volontario[0] }}" {% if volontario[0] == filtro_volontario %}selected{% endif %}>
                                {{ volontario[1] }} {{ volontario[2] }}
                            </option>
                        {% endfor %}
                    </select>
                </div>
                <div class="col-md-4">
                    <label class="form-label">Data Inizio</label>
                    <input type="date" name="data_inizio" class="form-control" value="{{ data_inizio }}">
                </div>
                <div class="col-md-4">
                    <label class="form-label">Data Fine</label>
                    <input type="date" name="data_fine" class="form-control" value="{{ data_fine }}">
                </div>
            </div>
            <button type="submit" class="btn btn-primary btn-lg">Filtra</button>
        </form>

        <!-- Statistiche -->
        <h2 class="mt-5">Statistiche</h2>
        <p><strong>Totale visite:</strong> {{ statistiche.totale_visite }}</p>
        <p><strong>Accoglienza:</strong></p>
        <ul>
            <li>Buona: {{ statistiche.accoglienza['Buona'] }}</li>
            <li>Media: {{ statistiche.accoglienza['Media'] }}</li>
            <li>Scarsa: {{ statistiche.accoglienza['Scarsa'] }}</li>
        </ul>
        <p><strong>Visite per città:</strong></p>
        <ul>
            {% for citta, conteggio in statistiche.visite_per_citta.items() %}
                <li>{{ citta }}: {{ conteggio }}</li>
            {% endfor %}
        </ul>
        <p><strong>Statistiche per volontario:</strong></p>
        <ul>
            {% for email, info in statistiche_volontari.items() %}
                <li>{{ info.cognome }} {{ info.nome }}: {{ info.visite }} visite</li>
            {% endfor %}
        </ul>

        <!-- Tabella delle visite -->
        <h2 class="mt-5">Dettaglio Visite</h2>
        <table class="table table-bordered">
            <thead>
                <tr>
                    <th>Cognome</th>
                    <th>Nome</th>
                    <th>Assistito</th>
                    <th>Città</th>
                    <th>Accoglienza</th>
                    <th>Data Visita</th>
                    <th>Necessità</th>
                    <th>Cosa Migliorare</th>
                </tr>
            </thead>
            <tbody>
                {% for visita in visite %}
                    <tr>
                        <td>{{ visita[0] }}</td>
                        <td>{{ visita[1] }}</td>
                        <td>{{ visita[2] }}</td>
                        <td>{{ visita[3] }}</td>
                        <td>{{ visita[4] }}</td>
                        <td>{{ visita[5] }}</td>
                        <td>{{ visita[6] }}</td>
                        <td>{{ visita[7] }}</td>
                    </tr>
                {% endfor %}
            </tbody>
        </table>

        <!-- Pulsanti per download e azioni -->
        <div class="mt-3">
            <form action="/download_csv" method="post" style="display:inline;" target="_blank">
                <input type="hidden" name="volontario_email" value="{{ filtro_volontario }}">
                <input type="hidden" name="data_inizio" value="{{ data_inizio }}">
                <input type="hidden" name="data_fine" value="{{ data_fine }}">
                <button type="submit" class="btn btn-primary btn-lg">Scarica CSV</button>
            </form>
            <form action="/download_pdf" method="post" style="display:inline;" target="_blank">
                <input type="hidden" name="volontario_email" value="{{ filtro_volontario }}">
                <input type="hidden" name="data_inizio" value="{{ data_inizio }}">
                <input type="hidden" name="data_fine" value="{{ data_fine }}">
                <button type="submit" class="btn btn-primary btn-lg">Scarica PDF</button>
            </form>
            <a href="/clean" class="btn btn-warning btn-lg">Pulisci Database</a>
            <a href="/clean_volontari" class="btn btn-danger btn-lg">Pulisci Volontari</a>
            <a href="/logout" class="btn btn-secondary btn-lg">Logout</a>
        </div>
    </div>
</body>
</html>